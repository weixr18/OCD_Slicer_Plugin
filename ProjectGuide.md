# OCD_Slicer_Plugin 项目概览

## 1 简介

OCD_Slicer_Plugin是一个slicer插件项目，通过对识别病人肺部CT图像的分析，实现新冠肺炎(COVID-19引起的肺炎)的检测。

## 2 项目进度

目前已经有了的：
· slicer前端框架（细节待完善）
· 后端服务器框架（子进程，socket通信）
· 后端分割-检测-热图生成模块

还需要做的：

· 前端：热图展示模块

未来还可能有的：
· 肺叶分割（现在只是把整个肺从CT中分出来）
· 其他的分类分割算法（如速度提升、模型压缩、准确率提升、内存优化等）

目前性能状况：
· 时间：完整的一次CT图像检测需要约10s
 （NVIDIA GeForce MX130 + CUDA9.2 + Pytorch）
  其中首次判断加载模型需要20s。
· 内存：需占用约2GB

## 3 项目结构

项目主要文件均在OpenCOVID_Detecter目录下。下面是这个目录的结构。

-CT_Detect

CT检测插件模块。目前唯一的Slicer插件模块。
模块功能：输入病人CT图像（通过slicer软件导入，在slicer中为一个volume数据）。前端界面可以选择检测对象（从多个volume中选择一个，已经实现），以及进行检测。

收到开始检测信号后，前端接口开启后端进程（python3.6），并通过网络将volume数据传递给该进程。后端进程处理完毕后，将返回值以同样通过网络传给前端接口。前端进行处理之后，在界面上进行展示。具体实现见下文描述。


    --CT_Detect.py
    前端和前后端接口文件。

        Client
        客户端通信类。具体通信的实现。

        CT_DetectWidget
        插件模块窗口类，相当于QWidget类，负责GUI操作及交互，即前端。

        CT_DetectLogic
        插件模块逻辑类。在Client和Widget间传递参数。


    --server_py3.py
    后端服务器。负责与前端通信、调用各后端模块功能。

    --Utils

    后端组件库。后端所有实现代码均在此文件夹下。

        --data_py3.py
        进行数据预处理，包括大小调整、范围调整、切片等

        --segment_py3.py
        对每个切片生成肺分割。目前采用简单阈值+连通域算法，对大块肺边缘病变不太稳定。

        --detect_py3.py
        对每个切片进行CT分类。输入为CT切片和对应的mask（即分割）。

        ---net2d_py3.py
        各种卷积网络模型。目前使用其中的resnet152作为分类网络。resnet，残差网络，2015年由KaiMing He等提出。

        --grad_cam_py3.py

        生成热图的实现文件。
        输入判断为正类的体数据切片（就是诊断为有病的那些切片），输出每张切片对应的热图。热图是一种对神经网络判断过程进行可视化的方式，通过抽取已有模型中的梯度进行计算反推得到。

    --CMakeLists.txt

    项目构建的时候的make命令。目前无。

    --Testing

    测试脚本。目前无。

    --Resources

    前端资源文件。

-model

训练好的神经网络模型权重。

