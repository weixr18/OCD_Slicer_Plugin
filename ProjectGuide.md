# OCD_Slicer_Plugin 项目概览

## 1 简介

OCD_Slicer_Plugin是一个slicer插件项目，通过对识别病人肺部CT图像的分析，实现新冠肺炎(COVID-19引起的肺炎)的检测。

## 2 项目进度

目前已经有了的：
· 切片分类核心代码（后端）
· 热图生成核心代码（后端）
· 检测模块后端框架
· 检测模块的slicer前端框架
· 子进程调用（前后端接口框架）

还需要做的：
· 前后端通信（使用socket实现异步通信）
· 子进程非阻塞调用（插件初始化时即启动子进程，等待数据过来，处理完成以后用socket发回去）
· 检测模块slicer前端实现（选择数据，展示打分界面等）
· 分割生成核心代码（后端）（现在使用硬盘中存储的之前做好的sanmple data分割）（等待xzw学长）
· 分割和检测模块的前后端适配（主要是后端，前端如果想拿到分割的结果的话也需要适配）
· 分割模块和分类模块的联动（因为要分类首先要分割。分割是分类网络输入的一部分。）

未来还可能有的：
· 肺叶分割（现在只是把整个肺从CT中分出来）
· 其他的分类分割算法（如速度提升、模型压缩、准确率提升等）

## 3 项目结构

项目主要文件均在OpenCOVID_Detecter目录下。下面是这个目录的结构。

-CT_Detect

CT检测模块。插件的第一个也是到现在为止唯一的插件模块。
模块功能：输入病人CT图像（通过slicer软件导入，在slicer中为一个volume数据）。前端界面可以选择检测对象（从多个volume中选择一个，已经实现），以及进行检测。

收到开始检测信号后，前端接口开启后端进程（python3.6），并通过网络将volume数据传递给该进程。后端进程处理完毕后，将返回值以同样通过网络传给前端接口。前端进行处理之后，在界面上进行展示。具体实现见下文描述。


--CT_Detect.py

前端和前后端接口文件。py2.7.
其实是slicer自动生成的模块文件，相当于一个模板。只需要在其中修改函数的实现方式，就能通过slicer中的操作调用这里面的函数。该文件中三个类的相互关系以及各自作用参见之前群里的资料，里面都有写。其中最重要的是CT_DetectLogic类（逻辑类）的run函数（调用后端的函数）。

在该函数中，要实现这几个功能：

1. 开启子进程(初始化的时候做)
2. 打开网络接口，和子进程的网络接口建立连接(初始化的时候做)
3. 通过网络接口传递要处理的数据
4. 等待后端进程处理（这部分可以非阻塞的做）
5. 接收后端进程返回的数据，包括检测结果和热图。
6. 将这些数据打包为np数组并返回给界面类，界面类进行展示

--detect_py3.py

后端主函数所在文件。py3.6.
包括：接收命令行参数，从网络接口接收前端发来的数据，进行数据处理，返回数据。
基本上就是各种接口。具体的操作都写在别的模块里。

--grad_cam_py3.py

生成热图的实现文件。学长写好的代码。py3.6.
输入判断为正类的体数据切片（就是诊断为有病的那些切片），输出每张切片对应的热图。所谓热图就是神经网络是根据哪些像素得到最终的判断的。相当于对神经网络的黑箱判断做可视化。具体实现是用pytorch根据已经建好的模型（卷积神经网络）进行梯度计算实现的。

--CMakeLists.txt

项目构建的时候的构建命令。现在不用管，因为还没到发布的时候

--Utils

通用组件库。目前只包括net2d_py3.py和data_py3.py。预想是将来所有的模块都可以使用这些组件。目前因为只有一个模块，所以放在这个模块的目录下。

---data_py3.py

读取数据。目前是从文件里读取数据，即将改为从网络接口接受数据

---net2d_py3.py

各种卷积网络模型。我们目前使用的分类网络是其中的一个resnet152。resnet就是残差网络，2015年由何凯明提出。具体参见网络上任何一篇介绍resnet的博客。未来可能会用到别的网络。比如分割网络就是一个修改过的VGG。

--Testing

自动生成的文件夹，不用管

--Resources

也是自动生成的文件夹，未来前端需要的资源文件（比如各种图片，logo，字体啥的）要放在里面



